!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["exports","react","react-dom"],n):n((e="undefined"!=typeof globalThis?globalThis:e||self).ReactSingletonHook={},e.React,e.ReactDOM)}(this,(function(e,n,t){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=o(n);function u(){return(u=Object.assign||function(e){for(var n=1;arguments.length>n;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}var i=function(e){var t=e.useHookBody,o=e.applyStateChange,r=n.useRef(e.initValue);if("function"!=typeof t)throw Error("function expected as hook body parameter. got "+typeof t);var u=t();return n.useLayoutEffect((function(){r.current!==u&&(r.current=u,o(u))}),[o,u]),null},a=function(e){console&&console.warn&&console.warn(e)},f="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,l=!1,c=!1,s=!1,d=[],p=function(e){return d.push(e),function(){throw Error("Can not unmount container! It is like a bug in react-singleton-hook library, because of unmountIfNoConsumers: true")}},m=function(){c=!0,n.useEffect((function(){l&&a("SingletonHooksContainer is mounted second time. You should mount SingletonHooksContainer before any other component and never unmount it.Alternatively, dont use SingletonHooksContainer it at all, we will handle that for you."),l=!0}),[]);var e=n.useState([]),t=e[0],o=e[1];return n.useEffect((function(){p=function(e){return o((function(n){return[].concat(n,[e])})),function(){o((function(n){return n.filter((function(n){return n!==e}))}))}},o(d)}),[]),r.default.createElement(r.default.Fragment,null,t.map((function(e,n){return r.default.createElement(i,u({},e,{key:n}))})))},y=function(e){var n;return c||s||(s=!0,n=m,f.document&&f.document.createElement?t.render(r.default.createElement(n,null),f.document.createElement("div")):a("Can not mount SingletonHooksContainer on server side. Did you manage to run useEffect on server? Please mount SingletonHooksContainer into your components tree manually.")),p(e)},g=function(e,o,r){void 0===r&&(r={});var u=!1,i=void 0,a=!1,f=void 0,l=[],c=r.unmountIfNoConsumers,s=void 0!==c&&c,d=function(e){f=e,t.unstable_batchedUpdates((function(){return l.forEach((function(n){return n(e)}))}))},p=function(){return a||(f="function"==typeof e?e():e,a=!0),f};return function(){var t=n.useState(p),r=t[0],a=t[1];return n.useEffect((function(){return u||(u=!0,i=y({initValue:e,useHookBody:o,applyStateChange:d})),l.push(a),f!==r&&a(f),function(){l.splice(l.indexOf(a),1),0===l.length&&s&&(i(),u=!1)}}),[]),r}},h={singletonHook:g,SingletonHooksContainer:m};e.SingletonHooksContainer=m,e.default=h,e.singletonHook=g,Object.defineProperty(e,"__esModule",{value:!0})}));
